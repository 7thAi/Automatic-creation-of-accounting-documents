# Программа автоматизации обработки фотографий и формирования отчетов

Автоматическое формирование приложений Word документов с фотографиями инспекции и расчетными таблицами на основе данных из Excel файлов.

## Описание

Программа предназначена для автоматизации процесса обработки фотографий инспекции объектов и создания отчетной документации. Система обрабатывает фотографии из иерархической структуры папок, заполняет данные в Excel файлы (Адресный перечень и Расчетные таблицы) и генерирует Word документы с фотографиями и подписями.

## Основные возможности

- **Анализ фотографий**: подсчет количества фотографий в папках по категориям (ДТ, МКД, ОДХ, ОО)
- **Заполнение адресного перечня (АП)**: автоматическое внесение данных о фотографиях и адресов объектов
- **Расчет статистики (РТ)**: агрегирование данных в таблицы с подсчетом объектов и нарушений
- **Создание приложений**: формирование Word документов с фотографиями в двухколонном формате
- **Приложение устранения**: отдельный документ с фотографиями только в левой колонке
- **Поддержка организаций**: работа с АВД (Автомобильные дороги) и Жилищниками
- **Сжатие изображений**: автоматическое приведение фотографий к 250 DPI перед вставкой

## Структура проекта

```
├── main.py                    # Главный файл программы
├── report_data.py            # Выбор организации (ГБУ) и получение номера приложения
├── photo_analyzer.py         # Анализ и подсчет фотографий
├── photo_compressor.py       # Сжатие изображений до целевого DPI
├── fill_ap.py                # Заполнение адресного перечня
├── fill_rt.py                # Заполнение расчетных таблиц
├── fill_prilozhenie.py       # Создание приложений с фотографиями
├── requirements.txt          # Зависимости проекта
└── Фото/                     # Папка с исходными фотографиями
    ├── 1. ДТ/                # Дорожно-транспортные сооружения
    ├── 2. МКД/               # Многоквартирные жилые дома
    ├── 3. ОДХ/               # Объекты дорожного хозяйства
    └── 4. ОО/                # Объекты благоустройства
```

## Требования

- Python 3.8+
- xlwings >= 0.30.0
- openpyxl >= 3.1.0
- python-docx >= 1.0.0
- Pillow >= 10.0.0

## Установка

```bash
# Клонировать репозиторий
git clone https://github.com/yourusername/photo-report-automation.git
cd photo-report-automation

# Создать виртуальное окружение
python -m venv .venv

# Активировать виртуальное окружение
# Windows:
.venv\Scripts\activate
# Linux/Mac:
source .venv/bin/activate

# Установить зависимости
pip install -r requirements.txt
```

## Использование

```bash
# Запустить программу
python main.py
```

### Процесс работы:

1. **Выбор организации**
   - Выбираете тип: АВД или Жилищник
   - Для Жилищников выбираете округ и конкретную организацию

2. **Ввод количеств объектов**
   - ДТ (всего и пройденные)
   - МКД (всего и пройденные)
   - ОДХ (всего и пройденные)
   - ОО (всего и пройденные)

3. **Автоматическая обработка**
   - Анализируются фотографии в папке `Фото/`
   - Заполняется адресный перечень
   - Рассчитываются таблицы статистики
   - Создаются Word документы с приложениями

4. **Результаты**
   - `Приложение.docx` - основной документ с фотографиями
   - `Приложение устранения.docx` - документ для устранения замечаний

## Структура папок фотографий

```
Фото/
├── 1. ДТ/
│   ├── 1. АБП/
│   │   ├── 1. Проезд АБП/
│   │   ├── 2. ДТС АБП/
│   │   └── ...
│   ├── 2. ДП/
│   └── 3. СП/
├── 2. МКД/
│   ├── 1. Вх. группа/
│   ├── 2. Отмостка/
│   └── ...
├── 3. ОДХ/
└── 4. ОО/
```

## Функциональность модулей

### report_data.py
Управление данными о ГБУ и выбор организации. Содержит справочник всех организаций Москвы с номерами приложений и кодами секций.

### photo_analyzer.py
Анализ структуры папок и подсчет количества фотографий по категориям.

### fill_ap.py
Заполнение Excel файла "Адресный перечень" данными о фотографиях с сохранением информации об адресах и типах нарушений.

### fill_rt.py
Заполнение Excel файла "Расчетные таблицы" с использованием xlwings для работы с VBA формулами и подсчетом статистики.

### fill_prilozhenie.py
Создание Word документов с автоматической вставкой фотографий, подписей с адресами и типами нарушений.

### photo_compressor.py
Сжатие изображений до целевого разрешения (250 DPI) перед вставкой в документы.

## Поддерживаемые организации

### Автомобильные дороги (АВД):
- ЦАО, САО, СВАО, ВАО, ЮВАО, ЮАО, ЮЗАО, ЗАО, СЗАО, ТиНАО

### Жилищники:
- По всем основным округам Москвы (ЦАО, САО, СВАО и т.д.)
- ГБУ «Жилищник ЗелАО» (Зеленоград)
- ТиНАО (Троицк, Щербинка и др.)

## Ошибки и пути их решения

### ModuleNotFoundError: No module named 'xlwings'
Установите зависимости:
```bash
pip install -r requirements.txt
```

### Шаблоны не найдены
Убедитесь, что папка `Шаблоны НЕ ТРОГАТЬ!!!` содержит необходимые файлы:
- `АП.xlsm` - шаблон адресного перечня
- `РТ.xlsx` - шаблон расчетных таблиц
- `Шаблон.docx` - шаблон приложения
- `Шаблон 2026 АвД.docx` - шаблон для АВД
- `Шаблон 2026 Жилищник.docx` - шаблон для Жилищников

## Особенности

- Программа работает с Excel 2016+ и использует VBA для расчетов в РТ
- Фотографии автоматически сжимаются до 250 DPI для оптимизации размера документа
- Поддерживает русскоязычные названия организаций и категорий
- Автоматически очищает временные файлы после обработки

## Лицензия

MIT

## Контакты

Для вопросов и предложений обращайтесь через GitHub Issues.
